{% load template_tags %}
<form id="{{ filter_id }}" action="{{ action }}" method="{% if method %}{{method}}{% else %}get{% endif %}" class="pull-left padded-bottom" accept-charset="utf-8">
    {% if method and not method.lower == 'get' %}
        {% csrf_token %}
    {% endif %}
    {% block prefilter %}

    {% endblock %}
    <div class="col-lg-12 col-xs-1 col-md-1 {{ class }} horizontal-filter">
        <div id="control-group">
            {% for field in a_form.visible_fields %}
                <td valign="top">
                  <label for="{{field.auto_id}}" class="horititle">{{ field.label }}</label>
                 {% if field.label_tag|is_mobile_number %}
                   <div class="input-prepend">
                       <span class="add-on">{{ country_phone_code }}</span>
                    </div>
                  {% endif %}
                   <span class="horiselect">{{field}}</span>
                </td>
            {% endfor %}
            {% if not no_button %}
                {% block submit_button %}
                    <td class="downbutton2">
                        <input type="submit" class="btn btn-primary" id="a-question-list" value="{%if filter_button_name %}{{filter_button_name}}{% else %}Refresh List{% endif %}" name="action" style=" border-left: 0px solid #0577e0 !important; padding: 3px; margin-top:5px; vertical-align: middle; margin-left: 20px !important" />
                    </td>
                {% endblock %}
            {% endif %}
        </div>
        {% if show_errors %}
        <tr id="error">
            {% for field in a_form.visible_fields %}
               {% if field.errors %}
                <td valign="top">
                   <label class="error">
                            {% for error in field.errors %}
                                {{ error}}
                            {% endfor %}
                   </label>
                </td>
               {% endif %}
            {% endfor %}
        </tr>
        {% endif %}

</div>
{% block postfilter %}

{% endblock %}

</form>
    <script src="{{ STATIC_URL }}/js/jquery-2.0.0.min.js" type="text/javascript" charset="utf-8"></script>
{% if no_auto_refresh %}
    <script type="text/javascript">
    $(function(){
        {% for field in a_form.visible_fields %}
            $('#{{ field.auto_id }}').on('change', function () {
                {% with a_form.visible_fields|next:forloop.counter0 as next %}
                    $('#{{ next.auto_id }}').val('');
                {% endwith %}
            });
        {% endfor %}
        });
    </script>

{% else %}
    {% block auto_refresh %}
    <script type="text/javascript">
    $(function(){
        {% for field in a_form.visible_fields %}
            $('#{{ field.auto_id }}').on('change', function () {
                {% with a_form.visible_fields|next:forloop.counter0 as next %}
                    $('#{{ next.auto_id }}').val('');
                {% endwith %}
                $('#{{ filter_id }}').submit();
            });
        {% endfor %}
        });
    </script>
    {% endblock %}
{% endif %}
<script type="text/javascript">
    $(function(){
       {% for location_type in location_filter_types %}
	    $('#id_{{ location_type }}').on('change', function () {
	    	params = { 'parent_loc' : $('#id_{{ location_type }}').val(), 'type' : '{{ location_type.pk }}'};
	    	url = "{% url 'location_sub_types' %}";
	        $.getJSON(url, params, function (data) {
	        	$('#id_' + data.sub_type +' option').hide();
	        	$('#id_' + data.sub_type +' option[value=""]').show();
        		$.each(data.locations, function () {
	                $('#id_' + data.sub_type +' option[value='+this.id+']').show();
	            });
        		$(' .chzn-select').trigger("liszt:updated");
	        });

	    });
 		{% endfor %}

        });
    </script>
<br class="clear" />
