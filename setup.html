<!DOCTYPE html>
<html>
<head>
    <title></title>
	<meta charset="utf-8" />
    <style>
        body{margin:0px;padding:0px;}
        .top{width:100%; height:80px; background-color:#0094ff;}
        .leftside{float:left;width:20%;}
		dl dt{background:#000; color:#fff;padding:5px; margin:2px 0px;max-width:450px;}
.rightside{float:left;width:80%;}        .content{width:1024px; margin:0 auto}
                                         .menu{margin:0px;}
                                         .menu li{list-style:none;padding:10px 15px; float:left;line-height:50px; }
                                         .menu li a{color:#fff;text-decoration:none; font-size:17px;font-weight: bold;font-family: Trebuchet MS, Myriad Pro, Arial;}
    </style>
</head>
<body>
    <div class="top">
        <div class="content">
            <div class="leftside">
                    <img  src="https://github.com/antsmc2/mics/blob/uSurvey/doc/uSurvey.png?raw=true" style="float:left" />
            </div>
            <div class="rightside">
                    <ul class="menu">
                        <li><a href="index.html">HOME</a></li>
                        <li><u><b><a href="setup.html">INSTALLATION</a></b></u></li>
                        <li><a href="usermanual.html">USER MANUAL</a></li>
                    </ul>
                    
            </div>
        </div>
    </div>


 <div class="content">
		 <div style="top:50px; position:relative;">
<h3><i>USurvey installation guide</l></h3>
<h4><i>Prerequisites</l></h4>

  <p>Postgres, redis-server should be running</p>
  <p>It helps to install python-dev, libxml2-dev, libxslt1-dev, zlib1g-dev and libffi-dev (for a debian based system, the command would be sudo apt-get install python-dev libxml2-dev libxslt1-dev zlib1g-dev libffi-dev)</p>
<br />
<h4><i>Installation instructions</i></h4>
Run the following commands to setup uSurvey on your server.
<dl>
  <dt>$ git clone https://github.com/unicefuganda/mics.git</dt>
  <dt>$ cd mics/mics</dt>
  <dt>$ cp travis-settings.py localsettings.py</dt>
  <dt>$ cd ../survey</dt>
    <dt>$ mkvirtualenv mics</dt>

    <dt>$ pip install -U -r pip-requires.txt</dt>

    <dt>$ python manage.py syncdb --noinput</dt>

    <dt>$ python manage.py makemigrations</dt>

    <dt>$ python manage.py migrate</dt>

    <dt>$ python manage.py load_parameters</dt>
</dl>
<br />
<h4><i>Loading location data</i></h4>
<p>uSurvey is designed around the idea that interviews shall be conducted in defined enumeration areas.</p>
<p>As part of initial setup, you need to load the application with the required administrative division 
and enumeration areas</p>
<p>Run the following command to import administrative division</p>
<dl>
 <dt>$ python manage.py import_location [LOCATION_FILE_CSV]</dt>
</dl>    
    <p><i>The first line of the csv file shall be taken as file header. </br></br>
    
    The file header is expected to contain names as per the Administrative division of the current country in a comma separated format. The last entry of the header can contain EAName</br>  
    Eg. For Uganda, example headers can be **Country,DistrictName,CountyName,SubCountyName,ParishName,VillageName,EAName </i></p>
    
<br />
<h4><i>Setting up Shape file</i></h4>
<p>To enable uSurvey capture survey data in country map, A few settings needs to be made on the mics/settings.py file.<br>
uSurvey must be made aware of the shape file to use. The shape file is expected to contain json data.<br>
Sample data is given below: </p>

<p>
{
"type": "FeatureCollection",
"crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:OGC:1.3:CRS84" } },                                                                               
"features": [
{ "type": "Feature", "properties": { "D_06_ID": 1.0, "DNAME_2006": "KALANGALA", "AREA": 7745049286.718000411987305, "PERIMETER": 360086.68, "HECTARES": 774504.929, "SUBREGION": "CENTRAL 1", "UNICEF": "Kampala Office", "Reg_2011": "BUGANDA" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 32.752554625197888, -0.149071180159047 ], [ 32.750256065472698, -0.997321195816234 ], [ 31.999165348402585, -0.997177585925673 ], [ 31.999929505377516, -0.382633576354547 ], [ 32.051271530088805, -0.335753704721339 ], [ 32.060643971387883, -0.303713379631932 ], [ 32.052504995368089, -0.272422328207899 ], [ 31.999540508585685, -0.216387568658223 ], [ 31.999689880245036, -0.151003632585263 ], [ 32.752554625197888, -0.149071180159047 ] ] ] } },
{ "type": "Feature", "properties": { "D_06_ID": 1.0, "DNAME_2006": "KAMPALA", "AREA": 194305275.828, "PERIMETER": 68787.571, "HECTARES": 19430.528, "DNAME_2010": "KAMPALA", "SUBREGION": "CENTRAL 1", "UNICEF": "Kampala Office", "Reg_2011": "BUGANDA" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 32.662105969306658, 0.284035417622536 ], [ 32.668022498091105, 0.277322598528355 ], [ 32.642901670945534, 0.245503088979917 ], [ 32.633514160694709, 0.217049622340069 ], [ 32.61518676687917, 0.229045627821064 ], [ 32.602891067137875, 0.259579229993582 ], [ 32.576991771882362, 0.280838983682295 ], [ 32.540136902642004, 0.27453181081871 ], [ 32.525943524305809, 0.300921350829158 ], [ 32.511397956843844, 0.30698218131173 ], [ 32.528979095921613, 0.342094394182897 ], [ 32.552912274710792, 0.351196862084601 ], [ 32.549160409492757, 0.378292529722675 ], [ 32.563782266921734, 0.389728747789749 ], [ 32.561716231138071, 0.40457483717538 ], [ 32.602177690381076, 0.407951500236093 ], [ 32.604336893211176, 0.393440071681235 ], [ 32.616880284253924, 0.390446068960009 ], [ 32.618548630962067, 0.380069112734243 ], [ 32.633974927458965, 0.380639753518482 ], [ 32.642330629075914, 0.330129964364422 ], [ 32.664678497107538, 0.32662949942806 ], [ 32.662105969306658, 0.284035417622536 ] ] ] } },
]}
<p>
Required settings are given below:<br>
&#9899; SHAPE_FILE_URI: This is the URI pointing to the shape file of the country. Example configurations are:<br><br>

SHAPE_FILE_URI = '/static/map_resources/uganda_districts_2011_005.json' <br>

    SHAPE_FILE_URI = 'http://someothershapedata/resources/mycountry.json'<br>
&#9899; SHAPE_FILE_LOC_FIELD: This is the primary field used to indicate the corresponding Administrative area whose shape file is presented in shape file list item<br><br>
&#9899;SHAPE_FILE_LOC_ALT_FIELD: This is the secondary field used to indicate the corresponding Administrative area whose shape file is presented in shape file list item. This entry shall be used if <b>SHAPE_FILE_LOC_FIELD</b> is missing in any shape data list item <br><br>
<b>NOTE:</b><br>
uSurvey expects shape file for the primary Administrative divisions of a country. Eg. If for Nigeria, system configuration for Administrative structure is <b>Country,State,Local Government Area,EAName,</b> Shape file should capture shapes for State only. Since uSurvey captures map reports based on the Primary Administrative division of the country. For Uganda, shape file would be based on Districts likewise.
<br />
<br />
<h4><i>Starting up uSurvey</i></h4>
<p>Starting the application is easy. Just run supervisor command from project directory. 
Notice that there is a supervisor configuration file bundled with the source. 
Make sure you configure appropriate ports in the supervisord.conf file before starting up the supervisor.</p>
<p>In supervisord.conf, the configuration under [program:odk-server] is required to serve ODK requests, 
while the configuration under [program:django-interface-server] is for serving other requests.
</p>
<dl>
    <dt>$ supervisord -c supervisord.conf</dt>
</dl>
<br />

    
</dl>
</div>
</div>
</body>
</html>
